<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Chargement - Breathia RP</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;overflow:hidden;color:#fff;height:100vh}

.split-container{
    display:grid;
    grid-template-columns:1fr 1fr;
    height:100vh;
    position:relative
}

.demons-side,.slayers-side{
    position:relative;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    overflow:hidden
}

.demons-side{
    background:linear-gradient(135deg,#1a0a0a,#3a1a1a,#2a0f0f)
}
.slayers-side{
    background:linear-gradient(135deg,#0a1a3a,#1a2a5a,#0f1f4a)
}

.demons-bg,.slayers-bg{
    position:absolute;
    inset:0;
    background-size:cover;
    background-position:center;
    opacity:.4
}
.demons-bg{background-image:url("https://wallpapercave.com/wp/wp10876400.jpg")}
.slayers-bg{background-image:url("https://wallpapercave.com/wp/wp11190883.jpg")}

.faction-title{
    font-size:3em;
    z-index:2;
    text-shadow:0 0 20px currentColor
}
.demons-side .faction-title{color:#d44b4b}
.slayers-side .faction-title{color:#6ba3d4}

.center-breathia{
    position:absolute;
    top:30px;
    left:50%;
    transform:translateX(-50%);
    z-index:10;
    text-align:center
}
.breathia-title{
    font-size:2.4em;
    font-weight:bold;
    background:linear-gradient(90deg,#ff4b4b,#fff,#ff4b4b);
    -webkit-background-clip:text;
    -webkit-text-fill-color:transparent
}

.loading-container{
    position:absolute;
    bottom:80px;
    left:50%;
    transform:translateX(-50%);
    width:80%;
    z-index:10
}
.loading-text{text-align:center;margin-bottom:10px}

.progress-bar{
    height:12px;
    background:#000a;
    border-radius:10px;
    overflow:hidden
}
.progress-fill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#d44b4b,#fff,#6ba3d4);
    transition:width .2s linear
}

.server-info{
    position:absolute;
    bottom:20px;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    gap:40px;
    z-index:10
}

.particles{position:absolute;inset:0;overflow:hidden;z-index:1}
.particle{
    position:absolute;
    width:3px;
    height:3px;
    border-radius:50%;
    animation:float linear infinite
}
.demons-side .particle{background:#d44b4b}
.slayers-side .particle{background:#6ba3d4}

@keyframes float{
    from{transform:translateY(0);opacity:.8}
    to{transform:translateY(-100vh);opacity:0}
}
</style>
</head>

<body>

<div class="split-container">

<div class="demons-side">
    <div class="demons-bg"></div>
    <div class="particles" id="demonsParticles"></div>
    <div class="faction-title">DÉMONS</div>
</div>

<div class="slayers-side">
    <div class="slayers-bg"></div>
    <div class="particles" id="slayersParticles"></div>
    <div class="faction-title">POURFENDEURS</div>
</div>

<div class="center-breathia">
    <div class="breathia-title">BREATHIA</div>
</div>

<div class="loading-container">
    <div class="loading-text" id="loadingText">Initialisation...</div>
    <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
    </div>
</div>

<div class="server-info">
    <div><strong>JOUEURS</strong><br><span id="players">0/?</span></div>
    <div><strong>MAP</strong><br><span id="mapName">---</span></div>
    <div><strong>GM</strong><br>mangarp</div>
</div>

</div>

<audio id="bgMusic" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
</audio>

<script>
/* ===== PARTICULES ===== */
function spawnParticles(id,count){
    const c=document.getElementById(id)
    for(let i=0;i<count;i++){
        const p=document.createElement("div")
        p.className="particle"
        p.style.left=Math.random()*100+"%"
        p.style.top=Math.random()*100+"%"
        p.style.animationDuration=(Math.random()*6+4)+"s"
        c.appendChild(p)
    }
}
spawnParticles("demonsParticles",40)
spawnParticles("slayersParticles",40)

/* ===== MUSIQUE (GMOD SAFE) ===== */
const music=document.getElementById("bgMusic")
music.volume=0.03
let started=false
function startMusic(){
    if(started)return
    started=true
    music.play().catch(()=>{})
}
document.addEventListener("click",startMusic)
document.addEventListener("keydown",startMusic)
window.addEventListener("load",startMusic)

/* ===== BARRE GMOD ===== */
let totalFiles=0
const progress=document.getElementById("progressFill")
const statusText=document.getElementById("loadingText")

function GameDetails(sn,url,map,max,steamid,gm){
    document.getElementById("mapName").textContent=map
}
function SetStatusChanged(s){statusText.textContent=s}
function DownloadingFile(f){statusText.textContent="Téléchargement : "+f}
function SetFilesTotal(t){totalFiles=t}
function SetFilesNeeded(n){
    if(totalFiles<=0)return
    const pct=Math.round(((totalFiles-n)/totalFiles)*100)
    progress.style.width=Math.max(0,Math.min(100,pct))+"%"
}

/* ===== BATTLEMETRICS (OPTIONNEL) ===== */
const SERVER_IP="51.178.49.51"
const SERVER_PORT="27015"

async function fetchServer(){
    try{
        const r=await fetch(`https://api.battlemetrics.com/servers?filter[game]=gmod&filter[search]=${SERVER_IP}:${SERVER_PORT}`)
        const j=await r.json()
        if(j.data&&j.data[0]){
            const s=j.data[0].attributes
            document.getElementById("players").textContent=`${s.players}/${s.maxPlayers}`
        }
    }catch(e){}
}
fetchServer()
setInterval(fetchServer,30000)
</script>

</body>
</html>
